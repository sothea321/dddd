<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOD Premium - Fixed Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Kantumruy Pro', sans-serif;
            background: #020617;
            color: #f8fafc;
            min-height: 100vh;
        }

        .glass {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background: #000;
            border-radius: 20px;
        }

        .video-container iframe, .video-container video, .video-locked {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%; border: 0; z-index: 20;
        }

        .btn-primary { background: linear-gradient(135deg, #3b82f6, #8b5cf6); }
        .btn-admin { background: linear-gradient(135deg, #f59e0b, #d97706); }

        .user-card {
            background: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 1.25rem;
            transition: all 0.2s ease;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 10px;
            z-index: 200;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        .playlist-lock-overlay {
            position: absolute;
            inset: 0;
            background: rgba(2, 6, 23, 0.8);
            backdrop-blur: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body class="p-3 lg:p-6">

    <div id="toast-container"></div>

    <div class="max-w-[1200px] mx-auto">
        <header class="flex justify-between items-center mb-6 bg-white/5 p-3 rounded-2xl border border-white/5">
            <div class="flex items-center gap-3 text-white">
                <div class="w-10 h-10 btn-primary rounded-xl flex items-center justify-center text-xl shadow-lg cursor-pointer hover:scale-105 transition-transform" onclick="handleAdminIconClick()">ğŸ›¡ï¸</div>
                <div>
                    <h1 class="text-xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400 uppercase tracking-tight">VOD Premium</h1>
                    <div id="user-status-display" class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">áŸáŸ’áá¶á“á—á¶á–: Guest</div>
                </div>
            </div>
            <button id="auth-btn" onclick="toggleModal('user-login-modal')" class="glass px-6 py-2 rounded-xl text-xs font-black text-white hover:bg-white/10 transition-all border border-white/10">á…á¼á›á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹</button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-8 space-y-6">
                <div id="player-wrapper" class="video-container shadow-2xl overflow-hidden border border-white/5">
                    <div id="locked-ui" class="video-locked flex flex-col items-center justify-center text-center p-6 bg-slate-950/90 backdrop-blur-lg">
                        <div class="text-5xl mb-4">ğŸ”</div>
                        <h2 class="text-xl font-black mb-3 text-white uppercase">áŸá¼á˜á…á¼á›á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹á‚áá“á¸</h2>
                        <button onclick="toggleModal('user-login-modal')" class="btn-primary px-8 py-3 rounded-2xl font-black text-sm text-white shadow-xl hover:opacity-90 active:scale-95 transition-all">á…á¼á› Login á¥á¡á¼áœá“áŸáŸ‡</button>
                    </div>
                </div>
                <div class="glass p-6 rounded-[2rem]">
                    <h2 id="current-title" class="text-xl font-black text-white mb-1 tracking-tight">áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸáœá¸áŠáŸá¢á¼</h2>
                    <p id="current-desc" class="text-slate-400 text-sm leading-relaxed">ášá¸á€ášá¶á™á‡á¶á˜á½á™á€á¶ášá‘áŸáŸ’áŸá“á¶áœá¸áŠáŸá¢á¼á€á˜áŸ’áŸá¶á“áŸ’áá€á˜áŸ’ášá·áá…áŸ’á”á¶áŸáŸ‹áŸ”</p>
                </div>
            </div>

            <div class="lg:col-span-4">
                <div class="glass rounded-[2rem] h-[500px] flex flex-col overflow-hidden shadow-2xl relative">
                    <div class="p-4 border-b border-white/5 text-slate-400 text-[10px] font-black uppercase tracking-widest flex justify-between">
                        <span>á”á‰áŸ’á‡á¸á—á¶á‚</span>
                        <span id="video-count-badge" class="text-blue-400">0 á—á¶á‚</span>
                    </div>
                    
                    <div id="playlist-lock" class="playlist-lock-overlay">
                        <div class="text-3xl mb-2">ğŸ”’</div>
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">á”á‰áŸ’á‡á¸á—á¶á‚ááŸ’ášá¼áœá”á¶á“á›á¶á€áŸ‹</p>
                        <p class="text-[9px] text-slate-500 mt-1">áŸá¼á˜á…á¼á›á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹áŠá¾á˜áŸ’á”á¸á˜á¾á›á—á¶á‚á‘á¶áŸ†á„á¢áŸáŸ‹</p>
                    </div>

                    <div id="playlist" class="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Login Modal -->
    <div id="user-login-modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[100] hidden items-center justify-center p-4">
        <div class="glass max-w-sm w-full p-8 rounded-[2rem] text-white">
            <h3 class="text-xl font-black text-center mb-6 uppercase">User Login</h3>
            <div class="space-y-4">
                <input type="text" id="login-user" placeholder="áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á”áŸ’ášá¾" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-blue-500 transition-all">
                <input type="password" id="login-pass" placeholder="á›áŸááŸá˜áŸ’á„á¶ááŸ‹" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-blue-500 transition-all">
                <button onclick="handleUserLogin()" class="w-full btn-primary py-3 rounded-xl text-sm font-black shadow-lg">á…á¼á›á‘áŸáŸ’áŸá“á¶</button>
                <button onclick="toggleModal('user-login-modal')" class="w-full text-slate-500 text-xs font-bold pt-2 hover:text-white">á”á·á‘</button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[100] hidden items-center justify-center p-4">
        <div class="glass max-w-xs w-full p-8 rounded-[2rem] text-white text-center">
            <h3 class="text-lg font-black mb-6 text-amber-500 uppercase">Admin Access</h3>
            <input type="password" id="admin-pass-input" placeholder="â€¢â€¢â€¢â€¢" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-center text-2xl font-black outline-none mb-6 focus:border-amber-500">
            <button onclick="handleAdminLogin()" class="w-full btn-admin py-3 rounded-xl text-sm font-black shadow-lg">á”á‰áŸ’á‡á¶á€áŸ‹</button>
            <button onclick="toggleModal('admin-login-modal')" class="w-full text-slate-500 text-xs font-bold pt-2 hover:text-white">á”áŸ„áŸ‡á”á„áŸ‹</button>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="admin-panel-modal" class="fixed inset-0 bg-slate-950/95 backdrop-blur-xl z-[110] hidden items-center justify-center p-4">
        <div class="bg-slate-900 w-full max-w-4xl max-h-[90vh] flex flex-col p-6 lg:p-8 rounded-[2.5rem] border border-white/10 text-white overflow-hidden shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">á€á¶ášá‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á¢áŸ’á“á€á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹</h3>
                <button onclick="toggleModal('admin-panel-modal')" class="w-10 h-10 flex items-center justify-center bg-white/5 hover:bg-red-600 rounded-full transition-all text-xl">âœ•</button>
            </div>

            <div class="bg-white/5 p-5 rounded-3xl border border-white/5 mb-6">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 items-end">
                    <input type="text" id="new-username" placeholder="Username" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-2 text-sm text-white outline-none">
                    <input type="text" id="new-password" placeholder="Password" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-2 text-sm text-white outline-none">
                    <button onclick="addUser()" class="btn-primary h-10 rounded-xl font-black text-xs text-white">á”á“áŸ’ááŸ‚á˜á¢áŸ’á“á€á”áŸ’ášá¾ááŸ’á˜á¸</button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto custom-scrollbar">
                <div id="user-list-container" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <script>
        const playlist = [
            { title: "Rampage (2018) Full Movie", url: "https://geo.dailymotion.com/player/xifi9.html?video=x9a08k8", desc: "áŸá€á˜áŸ’á˜á—á¶á–á”áŸ’ášá™á»á‘áŸ’á’áŠáŸá‡á€áŸ‹á…á·ááŸ’áášáœá¶á„áŸááŸ’áœá™á€áŸ’áŸ á“á·á„áá½á¢á„áŸ’á‚á¯á€áŸ”" },
            { title: "Big Buck Bunny HD", url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4", desc: "áœá¸áŠáŸá¢á¼áŸá˜áŸ’ášá¶á”áŸ‹ááŸáŸáŸ’ááŸá¶á€á›áŸ’á”á„á€á˜áŸ’ášá·áá…áŸ’á”á¶áŸáŸ‹áŸ”" }
        ];

        const DEFAULT_ADMIN_PASS = "123";
        let authorizedUsers = JSON.parse(localStorage.getItem('vod_users')) || [];
        let currentUser = null;
        let isAdmin = false;
        let activeVideoIdx = -1;

        function initApp() {
            // á‘á¶á‰á™á€áˆáŸ’á˜áŸ„áŸ‡áŠáŸ‚á›á”á¶á“ Login á…á»á„á€áŸ’ášáŸ„á™
            const loggedUser = localStorage.getItem('logged_in_user');
            
            if (loggedUser) {
                // á†áŸ‚á€á˜á¾á›áˆáŸ’á˜áŸ„áŸ‡á€áŸ’á“á»á„á”á‰áŸ’á‡á¸áŠáŸ„á™á˜á·á“ááŸ’áœá›áŸ‹á–á¸á¢á€áŸ’áŸášáá¼á…á’áŸ† (Case-insensitive check)
                const found = authorizedUsers.find(u => u.user.toLowerCase() === loggedUser.toLowerCase());
                if (found) {
                    currentUser = found.user; // á”áŸ’ášá¾áˆáŸ’á˜áŸ„áŸ‡áŠáŸ‚á›ášá€áƒá¾á‰á€áŸ’á“á»á„ Database
                    updateAuthUI();
                    renderPlaylist();
                    selectVideo(0);
                } else {
                    localStorage.removeItem('logged_in_user');
                    renderPlaylist();
                }
            } else {
                renderPlaylist();
            }
        }

        function handleUserLogin() {
            const uInput = document.getElementById('login-user').value.trim();
            const pInput = document.getElementById('login-pass').value.trim();
            
            if (!uInput || !pInput) {
                showToast("áŸá¼á˜á”áŸ†á–áŸá‰á±áŸ’á™á‚áŸ’ášá”áŸ‹!", "error");
                return;
            }

            // áŸáŸ’áœáŸ‚á„ášá€ User (á†áŸ‚á€áˆáŸ’á˜áŸ„áŸ‡ Case-insensitive ááŸ‚ Password ááŸ’ášá¼áœááŸ‚áŠá¼á…á‚áŸ’á“á¶á‘á¶áŸ†á„áŸáŸ’ášá»á„)
            const foundUser = authorizedUsers.find(u => 
                u.user.toLowerCase() === uInput.toLowerCase() && u.pass === pInput
            );
            
            if (foundUser) {
                // á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“á—á¶á–á…áŸ†á“á½á“áŠá„áŠáŸ‚á›á”á¶á“á…á¼á›
                foundUser.login_count = (foundUser.login_count || 0) + 1;
                localStorage.setItem('vod_users', JSON.stringify(authorizedUsers));
                
                // ášá€áŸ’áŸá¶á‘á»á€áˆáŸ’á˜áŸ„áŸ‡á–á·áá”áŸ’ášá¶á€áŠá€áŸ’á“á»á„ LocalStorage
                localStorage.setItem('logged_in_user', foundUser.user);
                currentUser = foundUser.user;
                
                updateAuthUI();
                renderPlaylist();
                toggleModal('user-login-modal');
                showToast("á…á¼á›á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹á‡áŸ„á‚á‡áŸá™!", "success");
                
                // áŸá˜áŸ’á¢á¶á Input
                document.getElementById('login-user').value = '';
                document.getElementById('login-pass').value = '';
                
                selectVideo(0);
            } else {
                showToast("áˆáŸ’á˜áŸ„áŸ‡ á¬á›áŸááŸá˜áŸ’á„á¶ááŸ‹á˜á·á“ááŸ’ášá¹á˜ááŸ’ášá¼áœ!", "error");
            }
        }

        function renderPlaylist() {
            const listEl = document.getElementById('playlist');
            const lockEl = document.getElementById('playlist-lock');
            document.getElementById('video-count-badge').innerText = `${playlist.length} á—á¶á‚`;
            
            if (currentUser || isAdmin) {
                lockEl.style.display = 'none';
                listEl.innerHTML = playlist.map((v, i) => `
                    <div onclick="selectVideo(${i})" class="p-3 rounded-2xl cursor-pointer transition-all border ${activeVideoIdx === i ? 'bg-blue-600/20 border-blue-500/50' : 'bg-white/5 border-transparent hover:bg-white/10'}">
                        <div class="flex items-center gap-3 text-white">
                            <div class="w-8 h-8 rounded-lg flex items-center justify-center bg-black/40 text-[10px] font-black ${activeVideoIdx === i ? 'text-blue-400' : 'text-slate-500'}">${i+1}</div>
                            <span class="text-xs font-bold truncate">${v.title}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                lockEl.style.display = 'flex';
                listEl.innerHTML = '';
            }
        }

        function renderUserTable() {
            const container = document.getElementById('user-list-container');
            if (authorizedUsers.length === 0) {
                container.innerHTML = `<div class="py-10 text-center text-slate-600 text-sm">á‚áŸ’á˜á¶á“á‚áá“á¸á€áŸ’á“á»á„á”áŸ’ášá–áŸá“áŸ’á’</div>`;
                return;
            }

            container.innerHTML = authorizedUsers.map((u, idx) => `
                <div class="user-card flex justify-between items-center px-6 py-4 mb-2">
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-white">${u.user}</span>
                        <span class="text-[10px] text-amber-500 font-mono">Pass: ${u.pass}</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-xs text-blue-400">Login: ${u.login_count || 0}</span>
                        <button onclick="deleteUser(${idx})" class="text-red-500 text-xs">á›á»á”</button>
                    </div>
                </div>
            `).join('');
        }

        function addUser() {
            const u = document.getElementById('new-username').value.trim();
            const p = document.getElementById('new-password').value.trim();
            
            if (!u || !p) return showToast("áŸá¼á˜á”áŸ†á–áŸá‰á‘á·á“áŸ’á“á“áŸá™!", "error");
            if (authorizedUsers.some(user => user.user.toLowerCase() === u.toLowerCase())) return showToast("áˆáŸ’á˜áŸ„áŸ‡á“áŸáŸ‡á˜á¶á“ášá½á…á á¾á™!", "error");
            
            authorizedUsers.push({ user: u, pass: p, login_count: 0 });
            localStorage.setItem('vod_users', JSON.stringify(authorizedUsers));
            
            document.getElementById('new-username').value = '';
            document.getElementById('new-password').value = '';
            renderUserTable();
            showToast("á”á“áŸ’ááŸ‚á˜á”á¶á“á‡áŸ„á‚á‡áŸá™", "success");
        }

        function deleteUser(idx) {
            if (confirm("áá¾á¢áŸ’á“á€á…á„áŸ‹á›á»á”á˜áŸ‚á“á‘áŸ?")) {
                const deletedUser = authorizedUsers[idx].user;
                authorizedUsers.splice(idx, 1);
                localStorage.setItem('vod_users', JSON.stringify(authorizedUsers));
                
                // á”á¾áŸá·á“á‡á¶á›á»á” User áŠáŸ‚á›á€áŸ†á–á»á„ Login áŸáŸ’ášá¶á”áŸ‹ ááŸ’ášá¼áœ Logout á‚á¶ááŸ‹á…áŸá‰
                if (currentUser === deletedUser) {
                    localStorage.removeItem('logged_in_user');
                    location.reload();
                } else {
                    renderUserTable();
                }
            }
        }

        function selectVideo(i) {
            if (!currentUser && !isAdmin) return toggleModal('user-login-modal');
            activeVideoIdx = i;
            renderPlaylist();
            const video = playlist[i];
            const wrapper = document.getElementById('player-wrapper');
            document.getElementById('current-title').innerText = video.title;
            document.getElementById('current-desc').innerText = video.desc;
            wrapper.innerHTML = `<iframe src="${video.url}&autoplay=1" allowfullscreen allow="autoplay"></iframe>`;
        }

        function updateAuthUI() {
            document.getElementById('user-status-display').innerText = `áŸáŸ’áá¶á“á—á¶á–: ${currentUser}`;
            document.getElementById('auth-btn').innerText = "á…á¶á€á…áŸá‰";
            document.getElementById('auth-btn').onclick = () => { 
                localStorage.removeItem('logged_in_user');
                location.reload(); 
            };
        }

        function handleAdminLogin() {
            const currentPass = localStorage.getItem('vod_admin_pass') || DEFAULT_ADMIN_PASS;
            if (document.getElementById('admin-pass-input').value === currentPass) {
                isAdmin = true;
                toggleModal('admin-login-modal');
                renderUserTable();
                renderPlaylist();
                toggleModal('admin-panel-modal');
                showToast("Welcome Admin!", "success");
            } else {
                showToast("á›áŸááŸá˜áŸ’á„á¶ááŸ‹ Admin áá»áŸ!", "error");
            }
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.classList.toggle('hidden');
            m.classList.contains('hidden') ? m.classList.remove('flex') : m.classList.add('flex');
        }

        function handleAdminIconClick() {
            if (isAdmin) toggleModal('admin-panel-modal');
            else toggleModal('admin-login-modal');
        }

        function showToast(msg, type) {
            const toast = document.createElement('div');
            toast.className = `notification ${type === 'success' ? 'bg-blue-600' : 'bg-red-600'} text-xs font-black`;
            toast.innerText = msg;
            document.getElementById('toast-container').appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        window.onload = initApp;
    </script>
</body>
</html>
